#!/bin/bash -e

. /usr/share/debconf/confmodule

if [ "$1" ]; then
	export LANG=C # avoid locale errors from perl
	ROOT="$1"
	chroot=chroot
	log='log-output -t user-setup'
else
	ROOT=
	chroot=
	log=
fi

mkdir $ROOT/zs_tmp

db_get package-setup/package-path
if [ -d "$RET" ]; then
    # begin to setup packages 
    for FILE in $RET/*.deb
    do
        cp $FILE $ROOT/zs_tmp/tmp.deb
        $chroot $ROOT dpkg -i zs_tmp/tmp.deb
        rm zs_tmp/tmp.deb
    done
fi

db_get package-setup/hook-path
if [ -d "$RET" ]; then
    # begin to exec hook
    for FILE in $RET/*.hook
    do
        cp $FILE $ROOT/zs_tmp/tmp.hook
        $chroot $ROOT zs_tmp/tmp.hook
        rm zs_tmp/tmp.hook
    done
fi

rm -rf $ROOT/zs_tmp